<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>【MySQL】基本语法 - Damion&#39;s Blog</title><meta name="Description" content="Damon&#39;s Blog"><meta property="og:title" content="【MySQL】基本语法" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/mysql_grammer/" /><meta property="og:image" content="http://example.org/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-17T14:21:40&#43;08:00" />
<meta property="article:modified_time" content="2020-06-17T14:21:40&#43;08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/logo.png"/>

<meta name="twitter:title" content="【MySQL】基本语法"/>
<meta name="twitter:description" content=""/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/mysql_grammer/" /><link rel="prev" href="http://example.org/linux-common-commands/" /><link rel="next" href="http://example.org/linux-du/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "【MySQL】基本语法",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/mysql_grammer\/"
        },"genre": "posts","keywords": "MySQL","wordcount":  2079 ,
        "url": "http:\/\/example.org\/mysql_grammer\/","datePublished": "2020-06-17T14:21:40+08:00","dateModified": "2020-06-17T14:21:40+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "damion"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Damion&#39;s Blog">Damion&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/portfolio"> 作品集 </a><a class="menu-item" href="https://github.com/damiony" title="GitHub" rel="noopener noreffer" target="_blank"><i class="fab fa-github fa-fw"></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Damion&#39;s Blog">Damion&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/portfolio" title="">作品集</a><a class="menu-item" href="https://github.com/damiony" title="GitHub" rel="noopener noreffer" target="_blank"><i class="fab fa-github fa-fw"></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">【MySQL】基本语法</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>damion</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/mysql/"><i class="far fa-folder fa-fw"></i>MySQL</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp; 发布于 <time datetime="2020-06-17">2020-06-17</time>&nbsp;
                </div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#概念">概念</a></li>
    <li><a href="#存储数据的特点">存储数据的特点</a></li>
    <li><a href="#sql分类"><code>SQL</code>分类</a></li>
    <li><a href="#rpm安装mysql">rpm安装mysql</a></li>
    <li><a href="#mysql核心目录">Mysql核心目录</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-分类">1. 分类</a></li>
            <li><a href="#2-配置文件">2. 配置文件</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mysql字符编码">mysql字符编码</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-查看语法">1. 查看语法</a></li>
            <li><a href="#2-设置编码">2. 设置编码</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#查看表的结构">查看表的结构</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#查询语句">查询语句</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-1">1. 语法</a></li>
            <li><a href="#2-执行顺序">2. 执行顺序：</a></li>
            <li><a href="#3-查询列表">3. 查询列表：</a></li>
            <li><a href="#4-起别名">4. 起别名</a></li>
            <li><a href="#5-mysql中的作用">5. mysql中+的作用</a></li>
            <li><a href="#6-distinct函数">6. distinct函数</a></li>
            <li><a href="#7-ifnull函数">7. ifnull函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#条件查询">条件查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-2">1. 语法</a></li>
            <li><a href="#2-执行顺序-1">2. 执行顺序</a></li>
            <li><a href="#3-筛选条件">3. 筛选条件</a></li>
            <li><a href="#4-示例">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#排序查询">排序查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-3">1. 语法</a></li>
            <li><a href="#2-执行顺序-2">2. 执行顺序</a></li>
            <li><a href="#3-说明">3. 说明</a></li>
            <li><a href="#4-示例-1">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#常见函数">常见函数</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-分类-1">1. 分类</a></li>
            <li><a href="#2-字符函数">2. 字符函数</a></li>
            <li><a href="#3-数学函数">3. 数学函数</a></li>
            <li><a href="#4-日期函数">4. 日期函数</a></li>
            <li><a href="#5-流程控制函数">5. 流程控制函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#分组函数">分组函数</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明">1. 说明</a></li>
            <li><a href="#2-列表">2. 列表</a></li>
            <li><a href="#3-补充说明">3. 补充说明</a></li>
            <li><a href="#4-示例-2">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#分组查询">分组查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-4">1. 语法</a></li>
            <li><a href="#2-执行顺序-3">2. 执行顺序</a></li>
            <li><a href="#3-说明-1">3. 说明</a></li>
            <li><a href="#4-示例-3">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#连接查询">连接查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-1">1. 说明</a></li>
            <li><a href="#2-sql连接查询分类">2. sql连接查询分类</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql92内连接">sql92内连接</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-5">1. 语法</a></li>
            <li><a href="#2-说明">2. 说明</a></li>
            <li><a href="#3-示例">3. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql99内连接">sql99内连接</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-6">1. 语法</a></li>
            <li><a href="#2-说明-1">2. 说明</a></li>
            <li><a href="#3-示例-1">3. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql99外连接">SQL99外连接</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-2">1. 说明</a></li>
            <li><a href="#2-语法">2. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#子查询">子查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-定义">1. 定义</a></li>
            <li><a href="#2-说明-2">2. 说明</a></li>
            <li><a href="#3-分类">3. 分类</a></li>
            <li><a href="#4-示例-4">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql99交叉连接">sql99交叉连接</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-7">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#分页查询">分页查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-8">1. 语法</a></li>
            <li><a href="#2-执行顺序-4">2. 执行顺序</a></li>
            <li><a href="#3-说明-2">3. 说明</a></li>
            <li><a href="#4-示例-5">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#联合查询">联合查询</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-3">1. 说明</a></li>
            <li><a href="#2-语法-1">2. 语法</a></li>
            <li><a href="#3-示例-2">3. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ddl语言">DDL语言</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-4">1. 说明</a></li>
            <li><a href="#2-库管理">2. 库管理</a></li>
            <li><a href="#3-表管理">3. 表管理</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#常用字段类型">常用字段类型</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-int">1. int</a></li>
            <li><a href="#2-doublefloat">2. double/float</a></li>
            <li><a href="#3-decimal">3. decimal</a></li>
            <li><a href="#4-char">4. char</a></li>
            <li><a href="#5-varchar">5. varchar</a></li>
            <li><a href="#6-text">6. text</a></li>
            <li><a href="#7-blob">7. blob</a></li>
            <li><a href="#8-date">8. date</a></li>
            <li><a href="#9-time">9. time</a></li>
            <li><a href="#10-timestampdatetime">10. timestamp/datetime</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#常见字段约束">常见字段约束</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-5">1. 说明</a></li>
            <li><a href="#2-列表-1">2. 列表</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#设置自增长列">设置自增长列</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-关键字">1. 关键字</a></li>
            <li><a href="#2-说明-3">2. 说明</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#dml">DML</a></li>
    <li><a href="#插入数据">插入数据</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-9">1. 语法</a></li>
            <li><a href="#2-说明-4">2. 说明</a></li>
            <li><a href="#3-示例-3">3. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#修改数据">修改数据</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-10">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#删除数据">删除数据</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-11">1. 语法</a></li>
            <li><a href="#2-delete和truncate的区别">2. delete和truncate的区别：</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#事务">事务</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-概念">1. 概念：</a></li>
            <li><a href="#2-四大特性">2. 四大特性：</a></li>
            <li><a href="#3-分类-1">3. 分类</a></li>
            <li><a href="#4-示例-6">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据库的隔离级别">数据库的隔离级别</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-6">1. 说明</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据的4种隔离级别">数据的4种隔离级别</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-隔离级别说明">1. 隔离级别说明</a></li>
            <li><a href="#2-oracle支持的事务隔离级别">2. Oracle支持的事务隔离级别：</a></li>
            <li><a href="#3-mysql支持的事务隔离级别">3. Mysql支持的事务隔离级别</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mysql设置隔离级别">MySql设置隔离级别</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-7">1. 说明</a></li>
            <li><a href="#2-mysql查看当前连接的隔离级别">2. mysql查看当前连接的隔离级别</a></li>
            <li><a href="#3-mysql修改当前连接的隔离级别">3. mysql修改当前连接的隔离级别</a></li>
            <li><a href="#4-mysql设置数据库系统全局的隔离级别">4. mysql设置数据库系统全局的隔离级别</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#savepoint">SAVEPOINT</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-8">1. 说明</a></li>
            <li><a href="#2-示例">2. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#视图">视图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-含义">1. 含义</a></li>
            <li><a href="#2-应用场景">2. 应用场景</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#创建视图">创建视图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-12">1. 语法</a></li>
            <li><a href="#2-示例-1">2. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#修改视图">修改视图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-13">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#删除视图">删除视图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-14">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#查看视图">查看视图</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-15">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#视图内容的更新">视图内容的更新</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-插入">1. 插入</a></li>
            <li><a href="#2-修改">2. 修改</a></li>
            <li><a href="#3-删除">3. 删除</a></li>
            <li><a href="#4-说明">4. 说明</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#变量">变量</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-系统变量">1. 系统变量</a></li>
            <li><a href="#2-自定义变量">2. 自定义变量</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#系统变量">系统变量</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-含义-1">1. 含义</a></li>
            <li><a href="#2-语法-2">2. 语法</a></li>
            <li><a href="#3-注意">3. 注意</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#自定义变量">自定义变量</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-含义-2">1. 含义</a></li>
            <li><a href="#2-用户变量">2. 用户变量</a></li>
            <li><a href="#3-局部变量">3. 局部变量</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#存储过程">存储过程</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-好处">1. 好处</a></li>
            <li><a href="#2-含义">2. 含义</a></li>
            <li><a href="#3-创建">3. 创建</a></li>
            <li><a href="#4-调用">4. 调用</a></li>
            <li><a href="#5-删除">5. 删除</a></li>
            <li><a href="#6-查看">6. 查看</a></li>
            <li><a href="#7-修改">7. 修改</a></li>
            <li><a href="#8-示例">8. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#函数">函数</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-9">1. 说明</a></li>
            <li><a href="#2-创建">2. 创建</a></li>
            <li><a href="#2-调用">2. 调用</a></li>
            <li><a href="#3-查看函数">3. 查看函数</a></li>
            <li><a href="#4-删除函数">4. 删除函数</a></li>
            <li><a href="#5-示例">5. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#流程控制结构">流程控制结构</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-顺序结构">1. 顺序结构</a></li>
            <li><a href="#2-分支结构">2. 分支结构</a></li>
            <li><a href="#3-循环结构">3. 循环结构</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#分支结构">分支结构</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-if函数">1. if函数</a></li>
            <li><a href="#2-case结构">2. case结构</a></li>
            <li><a href="#3-if结构">3. if结构</a></li>
            <li><a href="#4-示例-7">4. 示例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#循环结构">循环结构</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-分类-2">1. 分类</a></li>
            <li><a href="#1-循环控制语句">1. 循环控制语句</a></li>
            <li><a href="#2-语法-3">2. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mysql语句处理顺序">MySQL语句处理顺序</a></li>
    <li><a href="#join语句汇总">join语句汇总</a></li>
    <li><a href="#不需要创建索引的情况">不需要创建索引的情况</a></li>
    <li><a href="#mysql分层和引擎">mysql分层和引擎</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-分层">1. 分层</a></li>
            <li><a href="#2-myisam与innodb">2. MyISAM与InnoDB</a></li>
            <li><a href="#3-数据库引擎">3. 数据库引擎</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql优化">sql优化</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-需要优化的原因">1. 需要优化的原因</a></li>
            <li><a href="#2-sql">2. sql</a></li>
            <li><a href="#3-优化">3. 优化</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#索引">索引</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-10">1. 说明</a></li>
            <li><a href="#2-索引弊端">2. 索引弊端</a></li>
            <li><a href="#3-索引好处">3. 索引好处</a></li>
            <li><a href="#4-分类">4. 分类</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#创建索引">创建索引</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-方式一">1. 方式一</a></li>
            <li><a href="#2-方式二">2. 方式二</a></li>
            <li><a href="#3-注意-1">3. 注意</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#删除索引">删除索引</a></li>
    <li><a href="#查看索引">查看索引</a></li>
    <li><a href="#sql性能问题">SQL性能问题</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-说明-11">1. 说明</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql执行计划">SQL执行计划</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-语法-16">1. 语法</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#执行计划分析">执行计划分析</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-表的执行顺序因数量的改变而改变">1. 表的执行顺序，因数量的改变而改变</a></li>
            <li><a href="#1-id">1. id</a></li>
            <li><a href="#2-select_type">2. select_type</a></li>
            <li><a href="#3-table">3. table</a></li>
            <li><a href="#4-type">4. type</a></li>
            <li><a href="#5-possible_keys">5. Possible_keys</a></li>
            <li><a href="#6-key">6. key</a></li>
            <li><a href="#7-key_len">7. key_len</a></li>
            <li><a href="#8-ref">8. ref</a></li>
            <li><a href="#9-rows">9. rows</a></li>
            <li><a href="#10-extra">10. extra</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#sql优化-1">SQL优化</a></li>
    <li><a href="#单表优化">单表优化</a></li>
    <li><a href="#双表优化">双表优化</a></li>
    <li><a href="#三表优化">三表优化</a></li>
    <li><a href="#避免索引失效的一些原则">避免索引失效的一些原则</a></li>
    <li><a href="#其他的一些优化方法">其他的一些优化方法</a>
      <ul>
        <li>
          <ul>
            <li><a href="#order-by">order by</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#慢查询">慢查询</a></li>
    <li><a href="#mysqldumpslow">mysqldumpslow</a></li>
    <li><a href="#海量数据分析">海量数据分析</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-profiles">1. profiles</a></li>
            <li><a href="#2-精确分析">2. 精确分析</a></li>
            <li><a href="#3-全局查询日志">3. 全局查询日志</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#锁机制">锁机制</a>
      <ul>
        <li>
          <ul>
            <li><a href="#分类">分类</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#表锁">表锁</a>
      <ul>
        <li>
          <ul>
            <li><a href="#给表加锁">给表加锁</a></li>
            <li><a href="#查看加锁的表">查看加锁的表</a></li>
            <li><a href="#释放锁">释放锁</a></li>
            <li><a href="#加读锁的机制">加读锁的机制</a></li>
            <li><a href="#加写锁的机制">加写锁的机制</a></li>
            <li><a href="#mysql表级锁的锁模式">MySQL表级锁的锁模式</a></li>
            <li><a href="#分析表锁定">分析表锁定</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#行锁">行锁</a>
      <ul>
        <li>
          <ul>
            <li><a href="#总结">总结：</a></li>
            <li><a href="#注意事项">注意事项：</a></li>
            <li><a href="#行锁的一种特殊情况">行锁的一种特殊情况：</a></li>
            <li><a href="#缺点">缺点：</a></li>
            <li><a href="#优点">优点：</a></li>
            <li><a href="#行锁分析">行锁分析</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#主从复制">主从复制</a>
      <ul>
        <li>
          <ul>
            <li><a href="#优点-1">优点</a></li>
            <li><a href="#原理">原理</a></li>
            <li><a href="#特点">特点</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="概念">概念</h2>
<ol>
<li>
<p><code>DB</code>
数据库（database)：存储数据的仓库。它保存了一系列有组织的数据。</p>
</li>
<li>
<p><code>DBMS</code>
数据库管理系统（database management system）。数据库是通过<code>DBMS</code>创建和操作的容器。</p>
</li>
<li>
<p><code>SQL</code>
结构化查询语言（structure query language）:专门用来与数据库通信的语言。</p>
</li>
</ol>
<h2 id="存储数据的特点">存储数据的特点</h2>
<ol>
<li>一个数据库可以有多个表，每个表有一个名字。表名具有唯一性。</li>
<li>表具有一些特性，这些特性定义了数据在表中如何存储。</li>
<li>表由列组成，列也称为字段。</li>
<li>表中的数据是按行存储的。</li>
</ol>
<h2 id="sql分类"><code>SQL</code>分类</h2>
<ol>
<li><code>DDL</code>: 数据定义语言，用来定义数据库对象（库、表、列等）。</li>
<li><code>DML</code>: 数据操作语言，用来定义数据库记录（增、删、改）。</li>
<li><code>DCL</code>: 数据控制语言，用来定义访问权限和安全级别。</li>
<li><code>DQL</code>: 数据查询语言，用来查询记录。</li>
</ol>
<h2 id="rpm安装mysql">rpm安装mysql</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">rpm -ivh rpm软件名
</code></pre></td></tr></table>
</div>
</div><h2 id="mysql核心目录">Mysql核心目录</h2>
<h4 id="1-分类">1. 分类</h4>
<ol>
<li><code>/var/lib/mysql</code>：安装目录</li>
<li><code>/usr/share/mysql</code>：配置文件</li>
<li><code>/usr/bin</code>：命令目录（mysqladmin、mysqldump等）</li>
<li><code>/etc/init.d/mysql</code>：启动脚本</li>
</ol>
<h4 id="2-配置文件">2. 配置文件</h4>
<ol>
<li><code>my-huge.cnf</code>：高端服务器</li>
<li><code>my-large.cnf</code>：中等规模</li>
<li><code>my-medium.cnf</code>：一般</li>
<li><code>my-small.cnf</code>：较小</li>
</ol>
<p>以上配置文件默认不能识别，mysql5.5默认只能识别 <code>/etc/my.cnf</code>，mysql5.6默认识别 <code>/etc/mysql-default.cnf</code>。</p>
<h2 id="mysql字符编码">mysql字符编码</h2>
<h4 id="1-查看语法">1. 查看语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%char%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-设置编码">2. 设置编码</h4>
<p>修改<code>/etc/my.cnf</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>mysql<span class="o">]</span>
default-character-set<span class="o">=</span>utf8
   
<span class="o">[</span>client<span class="o">]</span>
default-character-set<span class="o">=</span>utf8
   
<span class="o">[</span>mysqld<span class="o">]</span>
<span class="nv">character_set_server</span><span class="o">=</span>utf8
<span class="nv">character_set_client</span><span class="o">=</span>utf8
<span class="nv">collation_server</span><span class="o">=</span>utf8_general_co
</code></pre></td></tr></table>
</div>
</div><p>修改编码，只对之后创建的数据库生效。</p>
<h2 id="查看表的结构">查看表的结构</h2>
<h4 id="1-语法">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">DESC</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SHOW</span><span class="w"> </span><span class="n">COLUMNS</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SHOW</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="查询语句">查询语句</h2>
<h4 id="1-语法-1">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-执行顺序">2. 执行顺序：</h4>
<ul>
<li>
<p><code>from</code>子句</p>
</li>
<li>
<p><code>select</code>子句</p>
</li>
</ul>
<h4 id="3-查询列表">3. 查询列表：</h4>
<ul>
<li>字段</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">last_name</span><span class="o">`</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">employees</span><span class="o">`</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>表达式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>常量</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>函数等</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">DATABASE</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">VERSION</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">USER</span><span class="p">();</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="4-起别名">4. 起别名</h4>
<ul>
<li>使用<code>as</code>关键字</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">USER</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s2">&#34;username&#34;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>使用空格</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="k">user</span><span class="p">()</span><span class="w"> </span><span class="n">username</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="5-mysql中的作用">5. mysql中+的作用</h4>
<ul>
<li>
<p>如果两个数都是数值型，则直接相加。</p>
</li>
<li>
<p>如果其中一个操作数为字符型，则将字符型转换成数值型。如果无法转换，则直接当作<code>0</code>处理。</p>
</li>
<li>
<p>其中一个操作数为null，结果为null。</p>
</li>
</ul>
<h4 id="6-distinct函数">6. distinct函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="7-ifnull函数">7. ifnull函数</h4>
<p>语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="nf">ifnull</span><span class="p">(</span><span class="err">表达式</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">表达式</span><span class="mi">2</span><span class="p">)</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>功能：</p>
<p>如果表达式1为<code>null</code>，则显示表达式2，否则显示表达式1。</p>
<h2 id="条件查询">条件查询</h2>
<h4 id="1-语法-2">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件；</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-执行顺序-1">2. 执行顺序</h4>
<ul>
<li>
<p><code>from</code>子句。</p>
</li>
<li>
<p><code>where</code>子句。</p>
</li>
<li>
<p><code>select</code>子句。</p>
</li>
</ul>
<h4 id="3-筛选条件">3. 筛选条件</h4>
<ul>
<li>
<p>按关系表达式筛选：<code>&lt;</code>、<code>&gt;</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>=</code>、<code>&lt;&gt;</code>，也可以使用 <code>!=</code> 但是不建议，<code>ANSI</code>标准中用的是<code>&lt;&gt;</code>。</p>
</li>
<li>
<p>按逻辑表达式筛选：<code>and</code>、<code>or</code>、<code>not</code>，也可以使用 <code>&amp;&amp;</code>、<code>||</code>、<code>!</code> 但是不建议。</p>
</li>
<li>
<p>模糊查询：<code>like</code>、<code>in</code>、<code>between ... and ...</code>、<code>is null</code>。</p>
</li>
</ul>
<h4 id="4-示例">4. 示例</h4>
<ul>
<li>查询部门编号不是 <code>50 ~ 100</code> 之间员工的姓名:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询姓名中包含字符<code>a</code>的员工。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%a%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询姓名最后一个字符为<code>a</code>的员工。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%a&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询姓名第一个字符为<code>a</code>的员工。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;a%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询姓名中第三个字符为<code>a</code>的员工。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;___a%&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1"># 有三个下划线_
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询姓名中第二个字符为<code>_</code>的员工信息。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;_\_%&#39;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1"># 或者
</span><span class="c1"># select * from employees where name like &#39;_$_%&#39; escape &#39;$&#39;;
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门编号是30/50/90的员工名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门编号是30～90之间的员工姓名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">90</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门编号不是30～90之间的员工姓名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">90</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="排序查询">排序查询</h2>
<h4 id="1-语法-3">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">排序列表</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-执行顺序-2">2. 执行顺序</h4>
<ul>
<li>
<p><code>from</code>子句</p>
</li>
<li>
<p><code>where</code>子句</p>
</li>
<li>
<p><code>select</code>子句</p>
</li>
<li>
<p><code>order by</code>子句</p>
</li>
</ul>
<h4 id="3-说明">3. 说明</h4>
<ul>
<li>
<p>排序列表可以是单个字段、多个字段、表达式、函数、列数、以及以上的组合。</p>
</li>
<li>
<p>默认升序asc，降序desc</p>
</li>
</ul>
<h4 id="4-示例-1">4. 示例</h4>
<ul>
<li>将员工按照工资降序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>按姓名长度进行升序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询员工信息，先按工资升序、再按部门将序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">asc</span><span class="p">,</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>按照列数进行排序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="常见函数">常见函数</h2>
<h4 id="1-分类-1">1. 分类</h4>
<ul>
<li>
<p>字符函数</p>
</li>
<li>
<p>数学函数</p>
</li>
<li>
<p>日期函数</p>
</li>
<li>
<p>流程控制函数</p>
</li>
</ul>
<h4 id="2-字符函数">2. 字符函数</h4>
<ul>
<li><code>concat</code>拼接字符</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="nf">concat</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">user</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>LENGTH</code>获取字节长度</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="s2">&#34;hello,少年&#34;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CHAR_LENGTH</code>获取字符长度</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">CHAR_LENGTH</span><span class="p">(</span><span class="s2">&#34;hello,少年&#34;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>SUBSTR</code>截取子串</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">SUBSTR</span><span class="p">(</span><span class="s1">&#39;少年你好骚啊&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1"># SELECT SUBSTR(&#39;你好骚啊少年&#39;,5);
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>INSTR</code>获取字符第一次出现的索引</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">INSTR</span><span class="p">(</span><span class="s1">&#39;孙悟空三打白骨精&#39;</span><span class="p">,</span><span class="s1">&#39;白骨精&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>TRIM</code>去除前后指定字符，默认去空格</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">TRIM</span><span class="p">(</span><span class="s1">&#39; 空  格 &#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">TRIM</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;xxx空xxx格xxx&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>LPAD/RPAD</code>左填充/右填充</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1"># 左填充满10个字符
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">LPAD</span><span class="p">(</span><span class="s1">&#39;木婉清&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1"># 右填充满10个字符
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">RPAD</span><span class="p">(</span><span class="s1">&#39;木婉清&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>UPPER/LOWER</code>变大写/变小写</p>
</li>
<li>
<p><code>STRCMP</code>比较两个字符大小</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">STRCMP</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span><span class="s1">&#39;acb&#39;</span><span class="p">)</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>LEFT/RIGHT</code>截取子串</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;洪世贤&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-数学函数">3. 数学函数</h4>
<ul>
<li><code>ABS</code>绝对值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">ABS</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CELL</code>向上取整，返回大于等于该参数的最小整数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">CELL</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">09</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>FLOOR</code>向下取整，返回小于等于该参数的最大整数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">FLOOR</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">09</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>ROUND</code>四舍五入</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">ROUND</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">8765</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>TRUNCATE</code>截断</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">TRUNCATE</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">8765</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1"># 位数不够用0补齐
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>MOD</code>取余，实质上 <code>a % b = a - a/b*b</code>。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">MOD</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1"># SELECT -10%3;
</span><span class="c1"># SELECT 10%3;
</span><span class="c1"># SELECT -10%-3;
</span><span class="c1"># SELECT 10%-3;
</span></code></pre></td></tr></table>
</div>
</div><h4 id="4-日期函数">4. 日期函数</h4>
<ul>
<li><code>NOW</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">NOW</span><span class="p">();</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CURDATE</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">CURDATE</span><span class="p">();</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CURTIME</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">CURTIME</span><span class="p">();</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>DATEDIFF</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATEDIFF</span><span class="p">(</span><span class="s1">&#39;1998-7-16&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2019-7-13&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>DATE_FORMAT</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">DATE_FORMAT</span><span class="p">(</span><span class="s1">&#39;1998-7-16&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%Y年%M月%d日 %H小时%i分钟%s秒&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>STR_TO_DATE</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">STR_TO_DATE</span><span class="p">(</span><span class="s1">&#39;3/15 1998&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%m/%d %Y&#39;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="5-流程控制函数">5. 流程控制函数</h4>
<ul>
<li><code>IF</code>函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="mi">100</span><span class="o">&gt;</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;好&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;坏&#34;</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>CASE</code>函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CASE</span><span class="w"> </span><span class="err">表达式</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">值</span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">结果</span><span class="mi">1</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">值</span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">结果</span><span class="mi">2</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">ELSE</span><span class="w"> </span><span class="err">结果</span><span class="n">n</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CASE</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">条件</span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">结果</span><span class="mi">1</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">条件</span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">结果</span><span class="mi">2</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">ELSE</span><span class="w"> </span><span class="err">结果</span><span class="n">N</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="分组函数">分组函数</h2>
<h4 id="1-说明">1. 说明</h4>
<p>往往用于实现将一组数据进行统计计算，最终得到一个值，又称为聚合函数或者统计函数。</p>
<h4 id="2-列表">2. 列表</h4>
<ul>
<li>
<p><code>sum(字段名)</code>: 求和</p>
</li>
<li>
<p><code>avg(字段名)</code>: 求平均数</p>
</li>
<li>
<p><code>max(字段名)</code>: 求最大值</p>
</li>
<li>
<p><code>min(字段名)</code>: 求最小值</p>
</li>
<li>
<p><code>count(字段名)</code>: 计算非空字段值的个数</p>
</li>
</ul>
<h4 id="3-补充说明">3. 补充说明</h4>
<ul>
<li>
<p><code>count(*)</code>用于查询总行数。</p>
</li>
<li>
<p><code>count(1)</code>作用类似于<code>count(*)</code>，但是效率较低。</p>
</li>
<li>
<p><code>count()</code>搭配<code>distinct</code>做去重统计，如</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">department</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="4-示例-2">4. 示例</h4>
<ul>
<li>查询员工信息表中，所有员工的工资和、平均工资值、最低工资、最高工资、有工资的个数。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="分组查询">分组查询</h2>
<p>需要使用<code>group by</code>子句。</p>
<h4 id="1-语法-4">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">分组列表</span><span class="w">
</span><span class="w"></span><span class="k">having</span><span class="w"> </span><span class="err">分组后筛选</span><span class="w">
</span><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">排序列表</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-执行顺序-3">2. 执行顺序</h4>
<ul>
<li>
<p><code>from</code>子句</p>
</li>
<li>
<p><code>where</code>子句</p>
</li>
<li>
<p><code>group by</code>子句</p>
</li>
<li>
<p><code>having</code>子句</p>
</li>
<li>
<p><code>select</code>子句</p>
</li>
<li>
<p><code>order by</code>子句</p>
</li>
</ul>
<h4 id="3-说明-1">3. 说明</h4>
<ul>
<li>
<p>查询列表往往是分组函数和被分组的字段。</p>
</li>
<li>
<p>分组前筛选，基于原始表，使用<code>where</code>，位于<code>group by</code>前面。</p>
</li>
<li>
<p>分组后筛选，基于分组后的结果集，使用<code>having</code>，位于<code>group by</code>后面。</p>
</li>
</ul>
<h4 id="4-示例-3">4. 示例</h4>
<ul>
<li>查询每个工种员工平均工资</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="nf">avg</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="w"> </span><span class="n">job_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">job_id</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="连接查询">连接查询</h2>
<h4 id="1-说明-1">1. 说明</h4>
<p>又成多表查询，当查询的字段来自于多个表时，就会用到连接查询。</p>
<h4 id="2-sql连接查询分类">2. sql连接查询分类</h4>
<ul>
<li>
<p>年代：</p>
<ul>
<li>sql92标准：<code>mysql</code>仅仅支持内连接</li>
<li>sql99标准：<code>mysql</code>支持内连接+外连接（左外和右外）+交叉连接</li>
</ul>
</li>
<li>
<p>功能：</p>
<ul>
<li>内连接：等值连接、非等值连接、自连接</li>
<li>外连接：左外连接、右外连接、全外连接</li>
<li>交叉连接</li>
</ul>
</li>
</ul>
<h2 id="sql92内连接">sql92内连接</h2>
<h4 id="1-语法-5">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">表名</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="mi">2</span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-说明">2. 说明</h4>
<ul>
<li>
<p>为了解决多表字段重名，可以为表起别名。</p>
</li>
<li>
<p>表的顺序无要求。</p>
</li>
<li>
<p>n表连接，至少需要n-1个连接条件。</p>
</li>
</ul>
<h4 id="3-示例">3. 示例</h4>
<ul>
<li>等值连接：查询部门编号<code>&gt;100</code>的部门名和所在的城市名。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">department_name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">city</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="n">locations</span><span class="w"> </span><span class="n">l</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">location_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="o">`</span><span class="n">location_id</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">department_id</span><span class="o">`&gt;</span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>非等值连接：查询员工的工资和工资级别。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">grade_level</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="n">job_grades</span><span class="w"> </span><span class="n">g</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">lowest_sal</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">highest_sal</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>自连接：查询员工名和上级的名称。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">last_name</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">m</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">`</span><span class="n">manager_id</span><span class="o">`=</span><span class="n">m</span><span class="p">.</span><span class="o">`</span><span class="n">employee_id</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="sql99内连接">sql99内连接</h2>
<h4 id="1-语法-6">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="err">表明</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="p">[</span><span class="k">INNER</span><span class="p">]</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">表明</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">分组列表</span><span class="w">
</span><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="err">分组后筛选</span><span class="w">
</span><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">排序列表</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-说明-1">2. 说明</h4>
<ul>
<li>使用关键字<code>JOIN</code>代替了逗号，连接条件和筛选条件进行了分离。</li>
</ul>
<h4 id="3-示例-1">3. 示例</h4>
<ul>
<li>查询员工名和部门名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="n">department_name</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="n">d</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">department_id</span><span class="o">=</span><span class="n">d</span><span class="p">.</span><span class="n">department_id</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门编号<code>&gt;100</code>的部门名和所在的城市名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">department_name</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="n">d</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="n">l</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">location_id</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="o">`</span><span class="n">location_id</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">department_id</span><span class="o">`&gt;</span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门中员工个数<code>&lt;10</code>的部门名，并按照员工个数降序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="err">员工个数</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">department_name</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="n">d</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">`</span><span class="n">department_id</span><span class="o">`=</span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">department_id</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="o">`</span><span class="n">department_id</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="err">员工个数</span><span class="o">&gt;</span><span class="mi">10</span><span class="w">
</span><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">员工个数</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门员工的工资级别，并按照级别进行分组</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="err">个数</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">grade</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sal_grage</span><span class="w"> </span><span class="n">g</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">`</span><span class="n">salary</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">min_salary</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">max_salary</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">grade</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询员工名和对应的领导名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">e</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="n">m</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">`</span><span class="n">manager_id</span><span class="o">`=</span><span class="n">m</span><span class="p">.</span><span class="o">`</span><span class="n">employee_id</span><span class="o">`</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="sql99外连接">SQL99外连接</h2>
<h4 id="1-说明-2">1. 说明</h4>
<ul>
<li>
<p>查询结果为主表中所有的记录，如果从表有匹配项，则显示匹配项；如果从表没有匹配项，则显示null。</p>
</li>
<li>
<p>一般用于查询主表中有但从表中没有的记录。</p>
</li>
<li>
<p>外连接主从表的顺序不可随意改变。</p>
</li>
<li>
<p>左连接的主表在左边。</p>
</li>
<li>
<p>右连接的主表在右边。</p>
</li>
</ul>
<h4 id="2-语法">2. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">left</span><span class="o">|</span><span class="k">right</span><span class="o">|</span><span class="n">full</span><span class="w"> </span><span class="p">[</span><span class="k">outer</span><span class="p">]</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="子查询">子查询</h2>
<h4 id="1-定义">1. 定义</h4>
<p>当一个查询语句中，又嵌套了另一个完整的<code>select</code>语句，则被嵌套的语句称为子查询或内查询。</p>
<p>外面的语句称为主查询或外查询。</p>
<h4 id="2-说明-2">2. 说明</h4>
<ul>
<li>
<p>子查询不一定必须出现在<code>select</code>子句中，只是这种情况比较常见。</p>
</li>
<li>
<p>子查询放在条件中，要求必须出现在条件右侧</p>
</li>
<li>
<p>子查询一般放在小括号中</p>
</li>
<li>
<p>单行子查询对应了单行操作符：<code>&gt;, &lt;, &gt;=, &lt;=, =, &lt;&gt;</code></p>
</li>
<li>
<p>多行子查询对应了多行操作符：<code>any, some, all, in</code>（<code>some</code>和<code>any</code>的用法一致）</p>
</li>
</ul>
<h4 id="3-分类">3. 分类</h4>
<p>按出现位置：</p>
<ul>
<li><code>select</code>后面：子查询结果必须单行单列（标量子查询）</li>
<li><code>from</code>后面：子查询结果可以多行多列</li>
<li><code>where</code>或者<code>having</code>后面：子查询的结果必须为单列</li>
</ul>
<h4 id="4-示例-4">4. 示例</h4>
<ul>
<li>查询和Tom同部门的员工姓名和工资</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="n">department_id</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Tome&#39;</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询部门编号是50的员工个数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="err">个数</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询有无名字叫&quot;TOM&quot;的员工信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;TOM&#34;</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="err">有无</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="sql99交叉连接">sql99交叉连接</h2>
<h4 id="1-语法-7">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="mi">1</span><span class="w">
</span><span class="w"></span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="mi">2</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="p">,</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="分页查询">分页查询</h2>
<h4 id="1-语法-8">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w">  </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">join</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w">  </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">分组</span><span class="w">
</span><span class="w"></span><span class="k">having</span><span class="w"> </span><span class="err">分组后筛选</span><span class="w">
</span><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">排序列表</span><span class="w">
</span><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="err">起始条目索引，条目数</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-执行顺序-4">2. 执行顺序</h4>
<p><code>from -&gt; on -&gt; join -&gt; where -&gt; group by -&gt; having -&gt; select -&gt; order by -&gt; limit</code></p>
<h4 id="3-说明-2">3. 说明</h4>
<p>起始条目索引从0开始，缺省则默认为0</p>
<h4 id="4-示例-5">4. 示例</h4>
<ul>
<li>查询员工信息表的前5条</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">SEELCT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1"># 等价于
</span><span class="c1"># SELECT * FROM employees LIMIT 0,5;
</span></code></pre></td></tr></table>
</div>
</div><h2 id="联合查询">联合查询</h2>
<h4 id="1-说明-3">1. 说明</h4>
<ul>
<li>
<p>当查询结果来自于多张表，但多张表之间没有关联，这时可用联合查询，也称union查询。</p>
</li>
<li>
<p><code>union</code>自动去重</p>
</li>
<li>
<p><code>union all</code>可以支持重复项</p>
</li>
<li>
<p>多条待联合的查询语句，查询列数必须一致，类型、字段最好一致</p>
</li>
</ul>
<h4 id="2-语法-1">2. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span><span class="w"></span><span class="k">union</span><span class="w">
</span><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="err">查询列表</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-示例-2">3. 示例</h4>
<ul>
<li>查询所有国家的年龄<code>&gt;20</code>的用户信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">chinese</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usa</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">uage</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询所有国家的用户姓名和年龄</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">uage</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">usa</span><span class="w">
</span><span class="w"></span><span class="k">UNION</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">chinese</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="ddl语言">DDL语言</h2>
<h4 id="1-说明-4">1. 说明</h4>
<p><code>DDL</code>: （Data Define Language）数据定义语言，用于对数据库和表的管理和操作。</p>
<h4 id="2-库管理">2. 库管理</h4>
<ul>
<li>创建数据库</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="err">库名</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1"># CREATE DATEBASE IF NOT EXISTS 库名; # 如果不存在则创建
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>删除数据库</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="err">库名</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1"># DROP DATABASE IF EXISTS 库名; # 如果存在则删除
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-表管理">3. 表管理</h4>
<ul>
<li>创建表</li>
</ul>
<p>语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="p">]</span><span class="w"> </span><span class="err">表名</span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="err">字段名</span><span class="w"> </span><span class="err">字段类型</span><span class="w"> </span><span class="p">[</span><span class="err">字段约束</span><span class="p">]</span><span class="err">，</span><span class="w">
</span><span class="w">    </span><span class="p">......</span><span class="w">
</span><span class="w">    </span><span class="err">字段名</span><span class="w"> </span><span class="err">字段类型</span><span class="w"> </span><span class="p">[</span><span class="err">字段约束</span><span class="p">],</span><span class="w">
</span><span class="w">    </span><span class="err">字段名</span><span class="w"> </span><span class="err">字段类型</span><span class="w"> </span><span class="p">[</span><span class="err">字段约束</span><span class="p">]</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nf">stuinfo</span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="n">stuid</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">stuname</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">stugender</span><span class="w"> </span><span class="kt">CHAR</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">majorid</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_stuinfo_major</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">majorid</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="nf">major</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>修改表</li>
</ul>
<p>修改表名：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">原表名</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="err">新表名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>修改表字段：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">表名</span><span class="w"> </span><span class="k">ADD</span><span class="o">|</span><span class="n">MODIFY</span><span class="o">|</span><span class="k">CHANGE</span><span class="o">|</span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="err">字段名</span><span class="w"> </span><span class="err">字段类型</span><span class="w"> </span><span class="err">字段约束</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">students</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">dorndate</span><span class="w"> </span><span class="kt">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">CHANGE</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">borndate</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="kt">DATETIME</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="n">MODIFY</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="kt">TIMESTAMP</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">birthday</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>删除表</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>复制表</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename1</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">tablename2</span><span class="p">;</span><span class="w"> </span><span class="c1"># 仅复制表结构
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename1</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename2</span><span class="p">;</span><span class="w"> </span><span class="c1"># 复制结构和数据
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">emp</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="常用字段类型">常用字段类型</h2>
<h4 id="1-int">1. int</h4>
<p>整形：<code>TYNYINT, SMALLINT, INT, BIGINT</code>。</p>
<h4 id="2-doublefloat">2. double/float</h4>
<p>浮点型，例如double(5, 2)表示最多5位，其中有且仅有2位小数，即最大值为999.99</p>
<h4 id="3-decimal">3. decimal</h4>
<p>浮点型，表示钱时使用该类型，不会出现精度问题</p>
<h4 id="4-char">4. char</h4>
<p>固定长度字符串类型；内容范围是0~255字节；</p>
<p><code>char(n)</code>：n参数默认为1，不管实际存储，开辟空间都是<code>n</code>个字符，效率高。</p>
<h4 id="5-varchar">5. varchar</h4>
<p>可变长度字符串类型；内容范围为0~65535字节；</p>
<p><code>varchar(n)</code>最大字符个数必选，根据实际存储空间决定开辟空间，效率低。</p>
<p>实际占用空间为：字符实际空间 + 1，且字符实际空间 + 1 &lt;= n。</p>
<h4 id="6-text">6. text</h4>
<p>字符串类型，通常存储较长文本。</p>
<h4 id="7-blob">7. blob</h4>
<p>字节类型；常用于<code>jpg, mp3, avi</code>。</p>
<h4 id="8-date">8. date</h4>
<p>日期类型；格式为<code>yyyy-MM-dd</code></p>
<h4 id="9-time">9. time</h4>
<p>时间类型；格式为<code>hh:mm:ss</code></p>
<h4 id="10-timestampdatetime">10. timestamp/datetime</h4>
<p>时间戳类型；格式为<code>yyyyMMdd hhmmss</code>；</p>
<p><code>timestamp</code>保存范围<code>1900-1-1~xxxx年</code>，占用8字节；</p>
<p><code>datetime</code>保存范围<code>1970-1-1~2038-12-31</code>，占用4字节。</p>
<h2 id="常见字段约束">常见字段约束</h2>
<h4 id="1-说明-5">1. 说明</h4>
<p>用于限制表中字段的数据；</p>
<h4 id="2-列表-1">2. 列表</h4>
<ul>
<li>
<p><code>NOT NULL</code></p>
<p>非空；用于限制该字段为必填项；</p>
</li>
<li>
<p><code>DEFAULT</code></p>
<p>默认；如果该字段没有插入值，则显示默认值；</p>
</li>
<li>
<p><code>PRIMARY KEY</code></p>
<p>主键；用于限制该字段的值不能重复；设为主键列的字段默认不能为空；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tbl_name</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">column_list</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>UNIQUE</code></p>
<p>唯一；限制该字段不能重复；该字段可以为空；</p>
</li>
<li>
<p><code>CHECK</code></p>
<p>检查；限制该字段值必须满足指定条件；<code>mysql</code>不支持；</p>
</li>
<li>
<p><code>FOREIGN KEY</code></p>
<p>外键；限制两个表的关系；外键列的值必须来自主表的关联列；主表关联列和从表关联列类型必须一致，意思一样，名称无要求；主表的关联列要求必须是主键；</p>
<p>定义外键：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">teblename</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="err">外键名</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="err">列名</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="err">表名（关联列）</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="nf">teblename</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="p">...</span><span class="w">
</span><span class="w">	</span><span class="k">constraint</span><span class="w"> </span><span class="err">外键名</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="err">列名</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="err">表名</span><span class="p">(</span><span class="err">关联列</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>删除外键：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="err">键名</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="设置自增长列">设置自增长列</h2>
<h4 id="1-关键字">1. 关键字</h4>
<p><code>AUTO_INCREMENT</code></p>
<h4 id="2-说明-3">2. 说明</h4>
<ul>
<li>
<p>自增长列必须设置在一个键上，比如主键或唯一键。</p>
</li>
<li>
<p>自增长列要求数据类型为数值型。</p>
</li>
<li>
<p>一个表至多有一个自增长列。</p>
</li>
</ul>
<h2 id="dml">DML</h2>
<p><code>DML</code>: (Data Manipulation Language) 数据操作语言</p>
<ol>
<li>插入数据</li>
<li>修改数据</li>
<li>删除数据</li>
</ol>
<h2 id="插入数据">插入数据</h2>
<h4 id="1-语法-9">1. 语法</h4>
<ul>
<li>插入单行</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">表名</span><span class="p">(</span><span class="err">字段名</span><span class="mi">1</span><span class="err">，字段名</span><span class="mi">2</span><span class="err">，</span><span class="p">......)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">值</span><span class="mi">1</span><span class="err">，值</span><span class="mi">2</span><span class="err">，</span><span class="p">......);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>插入多行</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">表名（字段名</span><span class="mi">1</span><span class="err">，字段名</span><span class="mi">2</span><span class="err">，</span><span class="p">......)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="err">值</span><span class="mi">1</span><span class="err">，值</span><span class="mi">2</span><span class="err">，</span><span class="p">......),(</span><span class="err">值</span><span class="mi">1</span><span class="err">，值</span><span class="mi">2</span><span class="err">，</span><span class="p">......)...;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-说明-4">2. 说明</h4>
<ul>
<li>
<p>字段和值列表一一对应。</p>
</li>
<li>
<p>数值型值不用单引号，非数值型值必须使用单引号。</p>
</li>
</ul>
<h4 id="3-示例-3">3. 示例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">stuinfo</span><span class="w"> </span><span class="p">(</span><span class="n">stuid</span><span class="p">,</span><span class="w"> </span><span class="n">stuname</span><span class="p">,</span><span class="w"> </span><span class="n">stugender</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">majorid</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TOm&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;男&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tom@gmail.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="修改数据">修改数据</h2>
<h4 id="1-语法-10">1. 语法</h4>
<ul>
<li>修改单表：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">update</span><span class="w"> </span><span class="err">表名</span><span class="w">
</span><span class="w"></span><span class="kt">set</span><span class="w"> </span><span class="err">列</span><span class="o">=</span><span class="err">新值</span><span class="p">,</span><span class="w"> </span><span class="err">列</span><span class="o">=</span><span class="err">新值</span><span class="p">,...</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>修改多表，sql92语法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">update</span><span class="w"> </span><span class="err">表名</span><span class="mi">1</span><span class="w"> </span><span class="err">别名，表名</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="kt">set</span><span class="w"> </span><span class="err">列</span><span class="o">=</span><span class="err">值</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>修改多表，sql99语法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">update</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">inner</span><span class="o">|</span><span class="k">left</span><span class="o">|</span><span class="k">right</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="err">别名</span><span class="w">
</span><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="err">连接条件</span><span class="w">
</span><span class="w"></span><span class="kt">set</span><span class="w"> </span><span class="err">列</span><span class="o">=</span><span class="err">值</span><span class="p">,...</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="删除数据">删除数据</h2>
<h4 id="1-语法-11">1. 语法</h4>
<ul>
<li>delete语句：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">筛选条件</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>truncate语句:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">truncate</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">表名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-delete和truncate的区别">2. delete和truncate的区别：</h4>
<ul>
<li>
<p>delete可以添加where条件，truncate不能添加where条件，一次性清除所有数据。</p>
</li>
<li>
<p>truncate的效率较高。</p>
</li>
<li>
<p>如果删除带自增长列的表；使用delete删除后，重新插入数据时，记录从断点处开始；使用truncate删除后，重新插入数据时，记录从1开始。</p>
</li>
<li>
<p>delete删除数据时，会返回受影响的行数；truncate删除数据时，不会返回受影响的行数。</p>
</li>
<li>
<p>delete删除数据时，可以支持事务回滚；truncate删除数据时，不支持事务回滚。</p>
</li>
</ul>
<h2 id="事务">事务</h2>
<h4 id="1-概念">1. 概念：</h4>
<p>一个事务是由一条或者多条sql语句构成，这一条或者多条sql语句，要么全部执行成功，要么全部执行失败。</p>
<h4 id="2-四大特性">2. 四大特性：</h4>
<ul>
<li>
<p>原子性 (atomicity)：事务中所有操作是不可再分割的原子单位。事务中所有操作要么全部执行成功，要么全部执行失败。</p>
</li>
<li>
<p>一致性 (consistency)：事务执行后，数据库状态与业务规则保持一致。如转账业务，无论事务执行成功与否，参与转账的两个账号余额之和应该是不变的。</p>
</li>
<li>
<p>隔离性 (isolation)：在并发操作中，不同事务之间应该隔离开来，使每个并发中的事务不会相互干扰。</p>
</li>
<li>
<p>持久性 (durability)：一旦事务提交成功，事务中所有的数据操作都必须被持久化到数据库。即使提交事务后，数据库马上崩溃，在数据库重启时，也能通过某种机制恢复数据。</p>
</li>
</ul>
<h4 id="3-分类-1">3. 分类</h4>
<ol>
<li>
<p>隐式事务：没有明显的开启和结束标记</p>
</li>
<li>
<p>显式事务：具有明显的开启和结束标记</p>
<p>步骤：取消隐式事务自动开启的功能 =&gt; 开启事务 =&gt; 编写事务语句 =&gt; 结束事务</p>
</li>
</ol>
<h4 id="4-示例-6">4. 示例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#取消事务自动开启
</span><span class="c1"></span><span class="kt">SET</span><span class="w"> </span><span class="n">autocommit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">#开启事务 有的客户端不用加这句
</span><span class="c1"></span><span class="n">START</span><span class="w"> </span><span class="n">TRANSACTION</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">#更新数据
</span><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="n">balance</span><span class="o">=</span><span class="n">balance</span><span class="o">-</span><span class="mi">5000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">stuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">stuinfo</span><span class="w"> </span><span class="kt">SET</span><span class="w"> </span><span class="n">balance</span><span class="o">=</span><span class="n">balabce</span><span class="o">+</span><span class="mi">5000</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">stuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">#提交
</span><span class="c1"></span><span class="n">COMMIT</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="c1">#或者回滚
</span><span class="c1">#ROLLBACK;
</span></code></pre></td></tr></table>
</div>
</div><h2 id="数据库的隔离级别">数据库的隔离级别</h2>
<h4 id="1-说明-6">1. 说明</h4>
<p>对于同时运行的多个事务，当这些事务访问数据库中相同的数据时，如果没有采取必要的隔离机制，就会导致各种并发问题：</p>
<ul>
<li>脏读：对于两个事务T1和T2，T1读取了已经被T2更新但还没有被提交的字段，若之后T2回滚，T1读取的内容就是临时且无效的。</li>
<li>不可重复读：对于两个事务T1和T2，T1读取了一个字段，然后T2更新了该字段，之后T1再次读取同一个字段，获得的值就不同了。</li>
<li>幻读：对于两个事务T1和T2，T1从一个表中根据某些条件读取出一些记录，然后T2向该表插入了符合条件的新纪录，T1再次读取时，就会把新纪录也读出来。</li>
</ul>
<p>一个事务与其他事务隔离的程度称为隔离级别。不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但并发性越弱。</p>
<h2 id="数据的4种隔离级别">数据的4种隔离级别</h2>
<h4 id="1-隔离级别说明">1. 隔离级别说明</h4>
<ul>
<li>
<p>读未提交数据(READ UNCOMMITTED)：允许事务读取未被其他事务提交的变更。脏读，不可重复读和幻读的问题都会出现。</p>
</li>
<li>
<p>读已提交数据(READ COMMITTED)：只允许事务读取已经被其他事务提交的变更。可以避免脏读，但不可重复读和幻读问题仍然会出现。</p>
</li>
<li>
<p>可重复读(REPEATABLE READ)：确保事务可以多次从一个字段中读取相同的值，但这个事务持续期间，禁止其他事务对这个字段进行更新。可以避免脏读和不可重复读，但幻读的问题仍然存在。</p>
</li>
<li>
<p>串行化(SERIALIZABLE)：确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入、更新和删除操作，所有并发问题都可以避免，但性能十分低下。</p>
</li>
</ul>
<h4 id="2-oracle支持的事务隔离级别">2. Oracle支持的事务隔离级别：</h4>
<ul>
<li>
<p><code>READ COMMITED</code>（默认）</p>
</li>
<li>
<p><code>SERIALIZABLE</code></p>
</li>
</ul>
<h4 id="3-mysql支持的事务隔离级别">3. Mysql支持的事务隔离级别</h4>
<ul>
<li>
<p><code>READ UNCOMMITTED</code></p>
</li>
<li>
<p><code>READ COMMITTED</code></p>
</li>
<li>
<p><code>REPEATABLE READ</code>（默认）</p>
</li>
<li>
<p><code>SERIALIZABLE</code></p>
</li>
</ul>
<h2 id="mysql设置隔离级别">MySql设置隔离级别</h2>
<h4 id="1-说明-7">1. 说明</h4>
<p>每启动一个mysql客户端程序，就会获得一个单独的连接，每个连接都有一个变量<code>@@tx_isolation</code>表示当前的事务隔离级别。</p>
<h4 id="2-mysql查看当前连接的隔离级别">2. mysql查看当前连接的隔离级别</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">@@</span><span class="n">tx_isolation</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-mysql修改当前连接的隔离级别">3. mysql修改当前连接的隔离级别</h4>
<p>当前连接的隔离级别不会影响到其他连接。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="n">isolation</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">uncommitted</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="4-mysql设置数据库系统全局的隔离级别">4. mysql设置数据库系统全局的隔离级别</h4>
<p>需要重新打开<code>mysql</code>会话，设置才会生效。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="n">isolation</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">committed</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="savepoint">SAVEPOINT</h2>
<h4 id="1-说明-8">1. 说明</h4>
<p>只能搭配<code>rollback</code>使用</p>
<h4 id="2-示例">2. 示例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">SET</span><span class="w"> </span><span class="n">autocommit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">25</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">SAVEPOINT</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">28</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">ROLLBACK</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="视图">视图</h2>
<h4 id="1-含义">1. 含义</h4>
<ul>
<li>
<p>虚拟表，和普通表一样使用。</p>
</li>
<li>
<p><code>mysql5.1</code>版本之后出现的新特性。</p>
</li>
<li>
<p>行和列的数据，来自定义视图时的查询中使用到的表，并且是在使用视图时动态生成的。</p>
</li>
<li>
<p>只保存了sql逻辑，不保存查询结果。</p>
</li>
</ul>
<h4 id="2-应用场景">2. 应用场景</h4>
<ul>
<li>
<p>多个地方用到同样的查询结果。</p>
</li>
<li>
<p>该查询结果使用的sql语句较复杂。</p>
</li>
</ul>
<h2 id="创建视图">创建视图</h2>
<h4 id="1-语法-12">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="err">视图名</span><span class="w">
</span><span class="w"></span><span class="k">as</span><span class="w"> </span><span class="err">查询语句</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-示例-1">2. 示例</h4>
<ul>
<li>查询邮箱中包含a字符的员工名、部门名和工种信息。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#创建视图
</span><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">VIEW</span><span class="w"> </span><span class="n">myv1</span><span class="w">
</span><span class="w"></span><span class="k">AS</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">department</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">  </span><span class="n">e</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">departments</span><span class="w">  </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">department_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">department_id</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">jobs</span><span class="w">  </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">job_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">job_id</span><span class="p">;</span><span class="w">
</span><span class="w">   
</span><span class="w"></span><span class="c1">#使用视图
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myv1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s2">&#34;%a%&#34;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查询各部门的平均工资级别</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#创建视图
</span><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">VIEW</span><span class="w"> </span><span class="n">myv2</span><span class="w">
</span><span class="w"></span><span class="k">AS</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">ag</span><span class="p">,</span><span class="w"> </span><span class="n">department_id</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department_id</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">#使用
</span><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">myv2</span><span class="p">.</span><span class="o">`</span><span class="n">ag</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">grade_level</span><span class="w">
</span><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">myv2</span><span class="w">
</span><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">job_grades</span><span class="w"> </span><span class="n">g</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">myv2</span><span class="p">.</span><span class="o">`</span><span class="n">ag</span><span class="o">`</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">lowest_sal</span><span class="o">`</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="o">`</span><span class="n">highest_sal</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="修改视图">修改视图</h2>
<h4 id="1-语法-13">1. 语法</h4>
<p>方式一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="err">视图名</span><span class="w">
</span><span class="w"></span><span class="k">as</span><span class="w">
</span><span class="w"></span><span class="err">查询语句</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>方式二：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="err">视图名</span><span class="w">
</span><span class="w"></span><span class="k">as</span><span class="w">
</span><span class="w"></span><span class="err">查询语句</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="删除视图">删除视图</h2>
<h4 id="1-语法-14">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">drop</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="err">视图名，视图名</span><span class="p">......;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="查看视图">查看视图</h2>
<h4 id="1-语法-15">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">desc</span><span class="w"> </span><span class="err">视图名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="err">视图名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="视图内容的更新">视图内容的更新</h2>
<h4 id="1-插入">1. 插入</h4>
<ul>
<li>
<p>同表的插入语法一致。</p>
</li>
<li>
<p>会更新原始表。</p>
</li>
</ul>
<h4 id="2-修改">2. 修改</h4>
<ul>
<li>
<p>同表的修改语法一致。</p>
</li>
<li>
<p>会更新原始表。</p>
</li>
</ul>
<h4 id="3-删除">3. 删除</h4>
<ul>
<li>
<p>使用<code>delete</code>语法。</p>
</li>
<li>
<p>会更新原始表。</p>
</li>
</ul>
<h4 id="4-说明">4. 说明</h4>
<p>视图的可更新性和视图中查询的定义有关系，以下类型的视图不能更新：</p>
<ul>
<li>
<p>包含关键字：分组函数、distinct、group by、having、union、union all</p>
</li>
<li>
<p>常量视图</p>
</li>
<li>
<p>select子句中包含子查询</p>
</li>
<li>
<p>join（某些条件下可更新）</p>
</li>
<li>
<p>from一个不能更新的视图</p>
</li>
<li>
<p>where子句的子查询引用了from子句中的表</p>
</li>
</ul>
<h2 id="变量">变量</h2>
<h4 id="1-系统变量">1. 系统变量</h4>
<ul>
<li>
<p>全局变量</p>
</li>
<li>
<p>会话变量</p>
</li>
</ul>
<h4 id="2-自定义变量">2. 自定义变量</h4>
<ul>
<li>
<p>用户变量</p>
</li>
<li>
<p>局部变量</p>
</li>
</ul>
<h2 id="系统变量">系统变量</h2>
<h4 id="1-含义-1">1. 含义</h4>
<p>变量由系统提供，属于服务器层面。</p>
<h4 id="2-语法-2">2. 语法</h4>
<ul>
<li>查看所有的系统变量</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="n">session</span><span class="p">]</span><span class="w"> </span><span class="n">variables</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查看满足条件的部分系统变量</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="n">session</span><span class="p">]</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%char%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>查看指定的某个系统变量的值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">@@</span><span class="n">global</span><span class="p">.</span><span class="o">|</span><span class="p">[</span><span class="n">session</span><span class="p">.]</span><span class="err">系统变量名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>为某个系统变量赋值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">[</span><span class="n">session</span><span class="p">]</span><span class="w"> </span><span class="err">系统变量名</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">值</span><span class="p">;</span><span class="w"> 
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="o">@@</span><span class="n">global</span><span class="p">.</span><span class="o">|</span><span class="p">[</span><span class="n">session</span><span class="p">.]</span><span class="err">系统变量名</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">值</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-注意">3. 注意</h4>
<ul>
<li>
<p>如果是全局级别，需要使用global</p>
</li>
<li>
<p>如果是会话级别，需要加session或者什么都不加</p>
</li>
<li>
<p>全局变量不能跨重启，即服务器重启后变量值恢复默认</p>
</li>
</ul>
<h2 id="自定义变量">自定义变量</h2>
<h4 id="1-含义-2">1. 含义</h4>
<p>用户自定义的，不是系统提供的。</p>
<h4 id="2-用户变量">2. 用户变量</h4>
<ul>
<li>
<p>作用域：当前会话（连接）有效。</p>
</li>
<li>
<p>声明并初始化：</p>
</li>
</ul>
<p><code>set @变量名=值;</code></p>
<p>或者</p>
<p><code>set @变量名:=值;</code></p>
<p>又或者</p>
<p><code>select @变量名:=值;</code></p>
<ul>
<li>赋值：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="kt">set</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="p">:</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="p">:</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">字段</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>使用</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-局部变量">3. 局部变量</h4>
<ul>
<li>
<p>作用域：仅仅在定义它的begin end中有效</p>
</li>
<li>
<p>声明：</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">declare</span><span class="w"> </span><span class="err">变量名</span><span class="w"> </span><span class="err">类型</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">declare</span><span class="w"> </span><span class="err">变量名</span><span class="w"> </span><span class="err">类型</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="err">值</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>赋值：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="err">变量名</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="kt">set</span><span class="w"> </span><span class="err">变量名</span><span class="p">:</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="err">变量名</span><span class="p">:</span><span class="o">=</span><span class="err">值</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">字段</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="err">变量名</span><span class="w">
</span><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="err">表</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>使用：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span><span class="w"> </span><span class="err">变量名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>应用：</li>
</ul>
<p>begin中的第一句话。</p>
<h2 id="存储过程">存储过程</h2>
<h4 id="1-好处">1. 好处</h4>
<ol>
<li>提高了代码的重用性</li>
<li>简化操作</li>
<li>减少了编译次数，减少了和服务器的连接次数，提高了效率</li>
</ol>
<h4 id="2-含义">2. 含义</h4>
<p>一组预先编译好的sql语句的集合。</p>
<h4 id="3-创建">3. 创建</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">procedure</span><span class="w"> </span><span class="err">过程名</span><span class="p">(</span><span class="err">参数列表</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">begin</span><span class="w">
</span><span class="w"></span><span class="err">存储过程体</span><span class="w">
</span><span class="w"></span><span class="n">end</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ul>
<li>
<p>参数列表包含三部分：参数模式、参数名、参数类型</p>
</li>
<li>
<p>参数模式：</p>
<ul>
<li>
<p>IN：输入</p>
</li>
<li>
<p>OUT：输出</p>
</li>
<li>
<p>INOUT：输入和输出</p>
</li>
</ul>
</li>
<li>
<p>如果存储过程体只有一句话，begin、end可以省略。</p>
</li>
<li>
<p>存储过程体每句都以分号结束。</p>
</li>
<li>
<p>存储过程体的结尾使用delimiter重新设置。</p>
</li>
</ul>
<h4 id="4-调用">4. 调用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">call</span><span class="w"> </span><span class="err">存储过程名</span><span class="p">(</span><span class="err">实参列表</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="5-删除">5. 删除</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="err">过程名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="6-查看">6. 查看</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SHOW</span><span class="w"> </span><span class="n">CREATER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="err">过程名</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="7-修改">7. 修改</h4>
<p>存储过程无法修改。</p>
<h4 id="8-示例">8. 示例</h4>
<ul>
<li>无参</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#定义
</span><span class="c1"></span><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">myp1</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nf">admin</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">password</span><span class="o">`</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;john1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;lily&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="c1">#调用
</span><span class="c1"></span><span class="k">CALL</span><span class="w"> </span><span class="nf">myp1</span><span class="p">()</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>IN</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">myp2</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">beautyName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">bo</span><span class="p">.</span><span class="o">*</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">boys</span><span class="w"> </span><span class="n">bo</span><span class="w">
</span><span class="w">    </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">beauty</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">bo</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">boyfriend_id</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="n">beautyName</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>IN</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#定义
</span><span class="c1"></span><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">myp4</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">result</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">admin</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">admin</span><span class="p">.</span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="w">
</span><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">admin</span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PASSWORD</span><span class="p">;</span><span class="w">      	
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">result</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;成功&#39;</span><span class="p">,</span><span class="s1">&#39;失败&#39;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">#调用
</span><span class="c1"></span><span class="k">CALL</span><span class="w"> </span><span class="nf">myp4</span><span class="p">(</span><span class="s1">&#39;张飞&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;8888&#39;</span><span class="p">)</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>OUT</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#定义
</span><span class="c1"></span><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">myp5</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">beautyName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">OUT</span><span class="w"> </span><span class="n">boyName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">bo</span><span class="p">.</span><span class="n">boyName</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">boyName</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">boys</span><span class="w"> </span><span class="n">bo</span><span class="w">
</span><span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">beauty</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">bo</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">boyfriend_id</span><span class="w">
</span><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="n">beautyName</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">#调用
</span><span class="c1"></span><span class="p">[</span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">bName</span><span class="err">$</span><span class="p">]</span><span class="w">
</span><span class="w"></span><span class="k">CALL</span><span class="w"> </span><span class="nf">myp5</span><span class="p">(</span><span class="s1">&#39;小昭&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">bName</span><span class="p">)</span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">bName</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>INOUT</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">#定义
</span><span class="c1"></span><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">myp6</span><span class="p">(</span><span class="k">INOUT</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">INT</span><span class="p">,</span><span class="w"> </span><span class="k">INOUT</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="kt">INT</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="kt">SET</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="w">
</span><span class="w">    </span><span class="kt">SET</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="o">*</span><span class="mi">2</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">#调用
</span><span class="c1"></span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">m</span><span class="o">=</span><span class="mi">10</span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CALL</span><span class="w"> </span><span class="nf">myp6</span><span class="p">(</span><span class="o">@</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">n</span><span class="p">)</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="函数">函数</h2>
<p>函数和好处同存储过程。</p>
<h4 id="1-说明-9">1. 说明</h4>
<ul>
<li>有且仅有一个返回。</li>
</ul>
<h4 id="2-创建">2. 创建</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="err">函数名（参数列表）</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="err">返回类型</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w"></span><span class="err">函数体</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：</p>
<ol>
<li>参数列表包含两部分：参数名 参数类型。</li>
<li>函数体中必须包含return。</li>
<li>函数体仅有一句话，则可以省略begin和end。</li>
<li>使用delimiter语句设置结束标记。</li>
</ol>
<h4 id="2-调用">2. 调用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="err">函数名（参数列表）</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-查看函数">3. 查看函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SHOW</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="err">函数名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="4-删除函数">4. 删除函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">DROP</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="err">函数名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="5-示例">5. 示例</h4>
<ul>
<li>无参有返回</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">myf1</span><span class="p">()</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="kt">INT</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">c</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w">      
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">myf1</span><span class="p">()</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>有参有返回</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">myf2</span><span class="p">(</span><span class="n">empName</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="kt">DOUBLE</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="kt">SET</span><span class="w"> </span><span class="o">@</span><span class="n">sal</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">sal</span><span class="w">
</span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span><span class="w">    </span><span class="n">name</span><span class="o">=</span><span class="n">empName</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="o">@</span><span class="n">sal</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w">      
</span><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="nf">myf2</span><span class="p">(</span><span class="s1">&#39;tom&#39;</span><span class="p">)</span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="流程控制结构">流程控制结构</h2>
<h4 id="1-顺序结构">1. 顺序结构</h4>
<p>程序从上往下依次执行</p>
<h4 id="2-分支结构">2. 分支结构</h4>
<p>从多条路径中选择一条去执行</p>
<h4 id="3-循环结构">3. 循环结构</h4>
<p>在满足一定条件的基础上，重复执行一段代码</p>
<h2 id="分支结构">分支结构</h2>
<h4 id="1-if函数">1. if函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">IF</span><span class="p">(</span><span class="err">表达式</span><span class="mi">1</span><span class="err">，表达式</span><span class="mi">2</span><span class="err">，表达式</span><span class="mi">3</span><span class="p">)</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>如果表达式1成立，则if函数返回表达式2的值，否则返回表达式3的值。</p>
<h4 id="2-case结构">2. case结构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CASE</span><span class="w"> </span><span class="err">变量</span><span class="o">|</span><span class="err">表达式</span><span class="o">|</span><span class="err">字段</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">要判断的值</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">返回的值</span><span class="mi">1</span><span class="err">或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">要判断的值</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">返回的值</span><span class="mi">2</span><span class="err">或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">ELSE</span><span class="w"> </span><span class="err">要返回的值</span><span class="n">n或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CASE</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">要判断的条件</span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">返回的值</span><span class="mi">1</span><span class="err">或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">WHEN</span><span class="w"> </span><span class="err">要判断的条件</span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="err">返回的值</span><span class="mi">2</span><span class="err">或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">ELSE</span><span class="w"> </span><span class="err">要返回的值</span><span class="n">n或语句</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="k">CASE</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-if结构">3. if结构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">if</span><span class="w"> </span><span class="err">条件</span><span class="mi">1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="err">语句</span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">elseif</span><span class="w"> </span><span class="err">条件</span><span class="mi">2</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="err">语句</span><span class="mi">2</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">else</span><span class="w"> </span><span class="err">语句</span><span class="n">n</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>应用在<code>begin/end</code>中。</p>
<h4 id="4-示例-7">4. 示例</h4>
<ul>
<li>case</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="nf">test_case</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="kt">INT</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">CASE</span><span class="w">
</span><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;=</span><span class="mi">90</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">score</span><span class="o">&lt;=</span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;=</span><span class="mi">80</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;=</span><span class="mi">60</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">END</span><span class="w"> </span><span class="k">CASE</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>if结构</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">DELIMITER</span><span class="w"> </span><span class="err">$</span><span class="w">
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="nf">test_if</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="kt">INT</span><span class="p">)</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="kt">CHAR</span><span class="w">
</span><span class="w"></span><span class="n">BEGIN</span><span class="w">
</span><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;=</span><span class="mi">90</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">score</span><span class="o">&lt;=</span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">ELSEIF</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;=</span><span class="mi">80</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">END</span><span class="w"> </span><span class="err">$</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="循环结构">循环结构</h2>
<h4 id="1-分类-2">1. 分类</h4>
<ul>
<li>
<p>while</p>
</li>
<li>
<p>loop</p>
</li>
<li>
<p>repeat</p>
</li>
</ul>
<h4 id="1-循环控制语句">1. 循环控制语句</h4>
<ul>
<li>iterate 类似于 continue</li>
<li>leave 类似于 break</li>
</ul>
<h4 id="2-语法-3">2. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="p">[</span><span class="err">标签</span><span class="p">:]</span><span class="k">while</span><span class="w"> </span><span class="err">循环条件</span><span class="w"> </span><span class="n">do</span><span class="w">
</span><span class="w"></span><span class="err">循环体</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">end</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">[</span><span class="err">标签</span><span class="p">];</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="p">[</span><span class="err">标签</span><span class="p">:]</span><span class="k">loop</span><span class="w">
</span><span class="w"></span><span class="err">循环体</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">end</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">[</span><span class="err">标签</span><span class="p">];</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="p">[</span><span class="err">标签</span><span class="p">:]</span><span class="k">repeat</span><span class="w">
</span><span class="w"></span><span class="err">循环体</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="n">until</span><span class="w"> </span><span class="err">结束循环的条件</span><span class="w">
</span><span class="w"></span><span class="n">end</span><span class="w"> </span><span class="k">repeat</span><span class="w"> </span><span class="p">[</span><span class="err">标签</span><span class="p">];</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="mysql语句处理顺序">MySQL语句处理顺序</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">left_table</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="n">join_condition</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="o">&lt;</span><span class="n">join_type</span><span class="o">&gt;</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="o">&lt;</span><span class="n">right_table</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">where_condition</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">group_by_list</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="o">&lt;</span><span class="n">having_condition</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">SELECT</span><span class="w">
</span><span class="w"></span><span class="k">DISTINCT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">order_by_condition</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">limit_number</span><span class="o">&gt;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="join语句汇总">join语句汇总</h2>
<ul>
<li><code>INNER JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">key</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>LEFT JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>RIGHT JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>LEFT JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>RIGHT JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>FULL OUTER JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">FULL</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>FULL OUTER JOIN</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">select_list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">FULL</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="k">key</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="不需要创建索引的情况">不需要创建索引的情况</h2>
<ol>
<li>表记录太少</li>
<li>频繁更新的字段不适合创建索引。</li>
<li>如果某个数据列包含许多重复内容，建立索引则没有什么实际效果。索引的选择性是指索引列中不同值的数据与表中记录数的比。一个索引的选择性越接近1，这个索引的效率就越高。</li>
</ol>
<h2 id="mysql分层和引擎">mysql分层和引擎</h2>
<h4 id="1-分层">1. 分层</h4>
<ul>
<li>连接层：提供与客户端连接的服务。</li>
<li>服务层：提供各种用户使用的接口；提供SQL优化器（mysql query optimizer）；</li>
<li>引擎层：提供了数据存储的方式（MyISAM，InnoDB等）；</li>
<li>存储层：存储数据。</li>
</ul>
<h4 id="2-myisam与innodb">2. MyISAM与InnoDB</h4>
<ul>
<li>
<p>MyISAM不支持主外键；InnoDB支持主外键。</p>
</li>
<li>
<p>MyISAM不支持事务；InnoDB支持事务。</p>
</li>
<li>
<p>MyISAM使用表锁，即使操作一条记录也会锁住整个表，不适合高并发操作；InnoDB使用行锁，操作时只锁一行，不对其他行有影响，适合高并发的操作。</p>
</li>
<li>
<p>MyISAM只缓存索引，不缓存真实数据；InnoDB不仅缓存索引还缓存真实数据，对内存要求较高，并且内存大小对性能有决定性影响。</p>
</li>
<li>
<p>MyISAM表空间小；InnoDB表空间大。</p>
</li>
<li>
<p>MyISAM关注性能；InnoDB关注事务。</p>
</li>
<li>
<p>MyISAM默认安装；InnoDB默认安装；（安装不代表默认使用）。</p>
</li>
</ul>
<h4 id="3-数据库引擎">3. 数据库引擎</h4>
<p>支持哪些引擎：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">engines</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>正在使用的引擎：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%storage_engine%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>修改引擎：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="nf">tb</span><span class="p">(</span><span class="w">
</span><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="kp">auto_increment</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">dept</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="kp">engine</span><span class="o">=</span><span class="n">MyISAM</span><span class="w"> </span><span class="kp">auto_increment</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kp">charset</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="sql优化">sql优化</h2>
<h4 id="1-需要优化的原因">1. 需要优化的原因</h4>
<p>性能低、执行时间太长、等待时间太长、SQl语句欠佳（连接查询）、索引失效、服务器参数设置不对等。</p>
<h4 id="2-sql">2. sql</h4>
<p>编写过程：<code>select ... from ... join ... on ... where ... group by ... having ... order by ... limit</code></p>
<p>解析过程：<code>from ... on ... join ... where ... group by ... having ... select ... order by limit ...</code></p>
<h4 id="3-优化">3. 优化</h4>
<p>主要就是在优化索引。</p>
<h2 id="索引">索引</h2>
<h4 id="1-说明-10">1. 说明</h4>
<p>相当于书的目录。</p>
<p>是帮助MySQL高效获取数据的数据结构。</p>
<p>即索引是数据结构（树：B树（默认）、Hash树。。。）</p>
<p>B树：小的节点放左边，大的节点在右边。一般都是指B+树，数据全部存放在叶节点中。B+树查询任意数据的次数都是n次（B+树的高度）。</p>
<h4 id="2-索引弊端">2. 索引弊端</h4>
<ul>
<li>索引本身很大，可以存放在内存/硬盘。</li>
<li>索引不是所有情况均适用：少量数据；频繁更新的字段；很少适用的字段等。</li>
<li>索引会降低增删改的效率。</li>
</ul>
<h4 id="3-索引好处">3. 索引好处</h4>
<ul>
<li>
<p>提高查询效率（降低IO使用率）。</p>
</li>
<li>
<p>降低CPU使用率（因为B树索引本身就是一个排好序的结构，因此在对数据排序时可以直接使用）。</p>
</li>
</ul>
<h4 id="4-分类">4. 分类</h4>
<ol>
<li>主键索引：列值不能重复，且不能为null</li>
<li>单值索引：单列构成的索引。一个表可以有多个单值索引。</li>
<li>唯一索引：构成唯一索引的列数据不能重复。</li>
<li>复合索引：多个列构成的索引。</li>
</ol>
<h2 id="创建索引">创建索引</h2>
<h4 id="1-方式一">1. 方式一</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="err">索引类型</span><span class="w"> </span><span class="err">索引名</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">表（字段）</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<ul>
<li>单值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">dept_index</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="nf">tbl</span><span class="p">(</span><span class="n">dept</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>唯一</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">name_index</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="nf">tbl</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>复合</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">dept_name_index</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="nf">tbl</span><span class="p">(</span><span class="n">dept</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-方式二">2. 方式二</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">表名</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="err">索引类型</span><span class="w"> </span><span class="err">索引名</span><span class="p">(</span><span class="err">字段</span><span class="p">)</span><span class="w"> 
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<ul>
<li>单值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="nf">dept_index</span><span class="p">(</span><span class="n">dept</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>唯一</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="nf">name_index</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>多值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="nf">dept_name_index</span><span class="p">(</span><span class="n">dept</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-注意-1">3. 注意</h4>
<p>如果一个字段是 primary key，则该字段默认就是主键索引。</p>
<h2 id="删除索引">删除索引</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">drop</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="err">索引名</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="err">表名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">drop</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">name_index</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tbl</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="查看索引">查看索引</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表名</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="err">表名\</span><span class="n">G</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="sql性能问题">SQL性能问题</h2>
<h4 id="1-说明-11">1. 说明</h4>
<ul>
<li>
<p>主要是通过分析SQL执行计划，分析性能。</p>
</li>
<li>
<p>注意，SQL查询优化器会干扰我们的优化。</p>
</li>
</ul>
<h2 id="sql执行计划">SQL执行计划</h2>
<h4 id="1-语法-16">1. 语法</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">explain</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SQL语句</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="执行计划分析">执行计划分析</h2>
<h4 id="1-表的执行顺序因数量的改变而改变">1. 表的执行顺序，因数量的改变而改变</h4>
<p>原因：笛卡尔积。</p>
<p>数据量小的表，优先查询。</p>
<h4 id="1-id">1. id</h4>
<p>id相同，从上往下顺序执行。</p>
<p>id不同，id值越大越优先查询（原因：在嵌套子查询时，先查内层，再查外层）。</p>
<p>id值有相同，又有不同，id值越大越优先，id值相同从上往下顺序执行。</p>
<h4 id="2-select_type">2. select_type</h4>
<ul>
<li>
<p><code>Primary</code>：包含子查询SQL中的主查询（最外层）。</p>
</li>
<li>
<p><code>Subquery</code>：包含子查询SQL中的子查询（非最外层）。</p>
</li>
<li>
<p><code>Simple</code>：简单查询（不包含子查询、union）。</p>
</li>
<li>
<p><code>derived</code>：衍生查询（使用到了临时表）；如在from子查询中只有一张表；又或者在from子查询中，如果有table1 union table2，则table1就是derived，table2就是union。</p>
</li>
<li>
<p><code>union</code>：说明见上例。</p>
</li>
<li>
<p><code>union result</code>：告知哪些表之间存在union查询。</p>
</li>
</ul>
<h4 id="3-table">3. table</h4>
<h4 id="4-type">4. type</h4>
<p><code>System &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</code></p>
<p>其中：<code>system</code>，<code>const</code>只是理想情况，实际能达到 <code>ref &gt; range</code>。</p>
<p>优化前提：有索引。</p>
<ul>
<li>
<p><code>system</code>（忽略）</p>
<p>只有一条数据的系统表；或衍生表只有一条数据的主查询。</p>
</li>
<li>
<p><code>const</code></p>
<p>仅仅能查到一条数据的<code>SQL</code>，用于<code>primary key</code>或者<code>unique</code>索引（类型与索引类型有关）。</p>
</li>
<li>
<p><code>eq_ref</code></p>
<p>唯一性索引；对于每个索引键的查询，返回匹配的唯一行数据（有且只有1个，不能为0）；常见于唯一索引和主键索引。</p>
</li>
<li>
<p><code>ref</code></p>
<p>非唯一性索引，对于每个索引键的查询，返回匹配的所有行。</p>
</li>
<li>
<p><code>range</code></p>
<p>检索指定范围的行。</p>
</li>
<li>
<p><code>index</code></p>
<p>查询全部索引表中的数据。</p>
</li>
<li>
<p><code>all</code></p>
<p>查询表中的所有数据。</p>
</li>
</ul>
<h4 id="5-possible_keys">5. Possible_keys</h4>
<p>可能用到的索引，是一种预测。</p>
<h4 id="6-key">6. key</h4>
<p>实际用到的索引。</p>
<h4 id="7-key_len">7. key_len</h4>
<p>索引的长度。</p>
<p>用于判断复合索引是否被完全使用。</p>
<p>对于<code>utf8</code>，一个字符占3个字节。</p>
<p>如果索引字段可以为<code>null</code>，则会使用1个字节用于标识。</p>
<p>如果索引字段为<code>varchar</code>，使用2个字节标识可变长度。</p>
<h4 id="8-ref">8. ref</h4>
<p>注意与<code>type</code>中的<code>ref</code>值区分。</p>
<p>作用：指明当前表所参照的字段。</p>
<p>如：<code>select ... where a.c = b.x;</code></p>
<h4 id="9-rows">9. rows</h4>
<p>被索引优化查询的数据个数（实际通过索引而查询到的数据个数）。</p>
<h4 id="10-extra">10. extra</h4>
<ul>
<li>
<p><code>using filesort</code></p>
<p>性能消耗大；需要“额外”一次排序（查询）。常见于<code>order by</code>语句中。</p>
<p>示例1：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>小结：对于单索引，如果排序和查找是同一个字段，则不会出现<code>using filesort</code>；如果排序和查找不是同一个字段，则会出现<code>using filesort</code>。</p>
<p>示例2：（注意存在a1, a2, a3, a4四个字段）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="nf">idx_a1_a2_a3</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">a3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a3</span><span class="p">;</span><span class="w"> </span><span class="c1"># using filesort
</span><span class="c1"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a2</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a3</span><span class="p">;</span><span class="w"> </span><span class="c1"># using filesort
</span><span class="c1"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>小结：对于复合索引，<code>where</code>和<code>order by</code>按照复合索引的顺序使用，不要跨列或无序使用。</p>
</li>
<li>
<p><code>using temporary</code></p>
<p>性能损耗大，用到了临时表。一般出现在<code>group by</code>语句中。</p>
<p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span><span class="w"> </span><span class="c1"># using temporary
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>using index</code></p>
<p>性能提升，常见于索引覆盖。</p>
<p>只要使用到的列，全部都在索引中，就称为”索引覆盖“。</p>
<p>不读取原文件，只从索引文件中获取数据（不需要回表查询）。</p>
<p>索引覆盖会对<code>possible_keys</code>和<code>key</code>造成影响：如果没有<code>where</code>，则索引只出现在<code>key</code>中；如果有<code>where</code>，则索引可能出现在<code>key</code>和<code>possible_keys</code>中。</p>
</li>
<li>
<p><code>using where</code></p>
<p>回表查询时，会出现<code>using where</code>。</p>
</li>
<li>
<p><code>impossible where</code></p>
<p><code>where</code>子句永远为<code>false</code>。</p>
</li>
<li>
<p><code>using join buffer</code></p>
<p><code>mysql</code>引擎使用了连接缓存。</p>
</li>
</ul>
<h2 id="sql优化-1">SQL优化</h2>
<p>SQL优化是一种概率层面的优化。</p>
<p>服务层有SQL优化器，可能会影响我们的优化。</p>
<h2 id="单表优化">单表优化</h2>
<ol>
<li>最佳左前缀，保持索引的定义和使用的顺序一致性</li>
<li>索引要逐步优化</li>
<li>将含in的范围查询，放到where的最后，防止失效</li>
</ol>
<h2 id="双表优化">双表优化</h2>
<ol>
<li>小表驱动大表</li>
<li>一般情况下，左外连接，给右表加索引；右外连接，给左表加索引。</li>
</ol>
<h2 id="三表优化">三表优化</h2>
<ol>
<li>小表驱动大表。</li>
<li>索引建立在经常查询的字段上。</li>
</ol>
<h2 id="避免索引失效的一些原则">避免索引失效的一些原则</h2>
<ol>
<li>复合索引，不要跨列或无序使用（最佳左前缀）。</li>
<li>复合索引，尽量使用全索引匹配。</li>
<li>不要在索引上进行任何操作（计算，函数，类型转换），否则索引失效。</li>
<li>复合索引不能使用”不等于“，否则自身以及右侧所有全部失效。</li>
<li>复合索引中如果有<code>&gt;</code>，自身和右侧全失效。</li>
<li>一般而言，范围查询之后的索引失效。</li>
<li>尽量使用覆盖索引。</li>
<li>like尽量以“常量”开头，不要以&quot;%&ldquo;开头，否则索引失效。</li>
<li>尽量不要使用类型转换。</li>
<li>尽量不要使用<code>or</code>，否则索引失效。</li>
</ol>
<h2 id="其他的一些优化方法">其他的一些优化方法</h2>
<h4 id="order-by">order by</h4>
<p>using filesort有两种算法：单路排序、双路排序。</p>
<p>双路排序扫描两次磁盘：从磁盘读取排序字段；读取其他字段。</p>
<p>单路排序扫描一次磁盘：读取全部字段（不一定真的是单次，有可能是多次IO）。</p>
<p>Mysql4.1之前默认使用双路排序；mysql4.1之前默认使用单路排序。</p>
<p>设置buffer的容量大小：<code>set max_length_for_sort_data = 1024</code>，单位byte。</p>
<p>如果<code>max_length_for_sort_data</code>值太低，mysql会自动从 单路切换成双路。</p>
<p>避免使用<code>select * ...</code></p>
<p>复合索引不要跨列使用。</p>
<p>保证排序字段的排序一致性。</p>
<h2 id="慢查询">慢查询</h2>
<p>mysql提供的一种日志记录，用于记录mysql响应超过阀值的语句，默认10秒。</p>
<p>默认是关闭的；建议调优时打开，最终部署时关闭。</p>
<p>检查是否打开了慢查询日志：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%slow_query_log%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>临时开启：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">slow_query_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>mysql服务器重启后会失效。</p>
<p>永久开启：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#/etc/my.cnf追加</span>
<span class="o">[</span>mysqld<span class="o">]</span>
<span class="nv">slow_query_log</span><span class="o">=</span><span class="m">1</span>
<span class="nv">slow_query_log_file</span><span class="o">=</span>/var/lib/mysql/local-slow.log
</code></pre></td></tr></table>
</div>
</div><p>慢查询阀值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s2">&#34;%log_query_time%&#34;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>设置慢查询阀值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">lomg_query_time</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>重新登陆后生效。</p>
<p>永久设置阀值：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#在/etc/my.cnf追加</span>
<span class="o">[</span>mysqld<span class="o">]</span>
<span class="nv">long_query_time</span><span class="o">=</span><span class="m">3</span>
</code></pre></td></tr></table>
</div>
</div><p>查询超过阀值的sql：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">gloval</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%slow_queries%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h2 id="mysqldumpslow">mysqldumpslow</h2>
<p>用于查看慢SQL。</p>
<h2 id="海量数据分析">海量数据分析</h2>
<h4 id="1-profiles">1. profiles</h4>
<p>查看开启状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%profiling%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>打开</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span><span class="w"> </span><span class="n">profiling</span><span class="o">=</span><span class="k">on</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>查看profiling打开之后，全部sql查询语句所花时间，不够精确</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">profiles</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="2-精确分析">2. 精确分析</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="err">上一步查询的</span><span class="n">query_id</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="n">cpu</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="err">上一步查询的</span><span class="n">query_id</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="3-全局查询日志">3. 全局查询日志</h4>
<p>记录开启之后的全部sql语句，仅仅在调优、开发过程中打开。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%general_log%&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1"># 查看状态
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">#记录在表中
</span><span class="c1"></span><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">general_log</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1"># 开启
</span><span class="c1"></span><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">log_output</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1"># sql记录在表中
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">#或者记录在文件中
</span><span class="c1"></span><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">general_log</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1"># 开启
</span><span class="c1"></span><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">log_output</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1"># 或者sql记录在文件中
</span><span class="c1"></span><span class="kt">set</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">general_log_file</span><span class="o">=</span><span class="s1">&#39;/tmp/general.log&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1"># 或者sql记录在文件中
</span></code></pre></td></tr></table>
</div>
</div><h2 id="锁机制">锁机制</h2>
<p>解决因资源共享，造成的并发问题。</p>
<h4 id="分类">分类</h4>
<p>按照操作类型：</p>
<ul>
<li>
<p>读锁（共享锁）：对同一个数据，多个读操作可以同时进行，互不干扰。</p>
</li>
<li>
<p>写锁（互斥锁）：如果当前写操作没有完毕，则无法进行其他的读、写。</p>
</li>
</ul>
<p>按照操作范围：</p>
<ul>
<li>
<p>表锁：一次性对一张表整体加锁。MyISAM使用表锁。开销小，加锁快，无死锁。但锁的范围大，容易发生锁冲突，并发度低。</p>
</li>
<li>
<p>行锁：一次性对一条数据加锁。InnoDB使用行锁。开销大，加锁慢，容易死锁。所得范围较小，不容易发生锁冲突，并发度高，很小概率发生高并发问题（脏读、幻读、不可重复读）。</p>
</li>
<li>
<p>页锁：</p>
</li>
</ul>
<h2 id="表锁">表锁</h2>
<h4 id="给表加锁">给表加锁</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">lock</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="err">表</span><span class="mi">1</span><span class="w"> </span><span class="k">read</span><span class="o">/</span><span class="k">write</span><span class="p">,</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="w"> </span><span class="k">read</span><span class="o">/</span><span class="k">write</span><span class="p">,</span><span class="w"> </span><span class="p">...;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="查看加锁的表">查看加锁的表</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="kp">tables</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="释放锁">释放锁</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">unlock</span><span class="w"> </span><span class="kp">tables</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="加读锁的机制">加读锁的机制</h4>
<p>如果一个会话对A表加了read锁，则该会话可以对A表进行读操作、不能进行写操作；不能对其它表进行读写操作。其它会话可以对A表进行读操作、进行写操作得等待锁释放；对其他表可以进行读写操作。</p>
<h4 id="加写锁的机制">加写锁的机制</h4>
<p>某个会话对表加写锁，之后可以对这张表进行任何操作，但是不能操作其它表。</p>
<p>其他会话对加写锁的表，进行增删改查时得等待锁释放。</p>
<h4 id="mysql表级锁的锁模式">MySQL表级锁的锁模式</h4>
<ol>
<li>MyISAM在执行查询语句前，会自动给涉及到的所有表加读锁；在执行更新操作前，会自动给涉及的表加写锁。</li>
<li>对MyISAM表的读操作，不会阻塞其他进程（会话）对同一表的读请求，会阻塞对同一表的写请求。</li>
<li>对MyISAm表的写操作，会阻塞其他进程（会话）对同一表的读和写操作，只有当锁释放时，才会进行其它进程的读写操作。</li>
</ol>
<h4 id="分析表锁定">分析表锁定</h4>
<ol>
<li>
<p>查看表锁定状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="kp">tables</span><span class="p">;</span><span class="w"> </span><span class="c1"># 1代表加了锁
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>分析表锁定的严重程度</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;table%&#39;</span><span class="p">;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>table_lock_immediate</code>：可能获取到的锁数。</li>
<li><code>tale_locks_waited</code>：需要等待的表锁数，该值越大，锁竞争越大。</li>
</ul>
<p>当<code>table_locks_immediate / table_locks_waited</code> &gt; 5000，建议采用InnoDB引擎。</p>
</li>
</ol>
<h2 id="行锁">行锁</h2>
<p>InnoDB默认采用行锁。</p>
<p>研究前提：关闭了自动commit</p>
<p>关闭语句：</p>
<ol>
<li><code>set autocommit=0</code></li>
<li><code>start transection</code></li>
<li><code>begin</code></li>
</ol>
<h4 id="总结">总结：</h4>
<ol>
<li>如果”会话1“对“某条数据a”进行了DML操作，则其他会话需要等待“会话1”对“数据a”提交事务。</li>
<li>行锁通过事务解锁。</li>
<li>不同会话对不同行数据进行操作，互不影响。</li>
<li>查询数据不会加锁。</li>
<li>可以通过<code>for update</code>对<code>query</code>语句进行加锁。</li>
</ol>
<h4 id="注意事项">注意事项：</h4>
<ol>
<li>如果没有索引，行锁会转换为表锁，需要通过<code>commit</code>进行解锁。</li>
</ol>
<h4 id="行锁的一种特殊情况">行锁的一种特殊情况：</h4>
<p>间隙锁：值在范围内，但却不存在。</p>
<p>如：<code>update ... where id &gt; 1 and id &lt; 9;</code>，如果<code>id=7</code>的数据不存在，则该行数据存在间隙锁。</p>
<p>如果有<code>where</code>，则实际加锁的范围是<code>where</code>后面的范围（不是实际的值）。</p>
<h4 id="缺点">缺点：</h4>
<p>比表锁性能损耗大。</p>
<h4 id="优点">优点：</h4>
<p>并发能力强，效率高。</p>
<h4 id="行锁分析">行锁分析</h4>
<ol>
<li>
<p>查看行锁状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">show</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%innodb_row_lock%&#39;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Innodb_row_locl_current_waits</code>：当前正在等待锁的数量。</li>
<li><code>Innodb_row_lock_time</code>：等待总时长，从系统启动到现在，一共等待的时间。</li>
<li><code>Innodb_row_lock_time_avg</code>：平均等待时长，从系统启动到现在的平均等待时间。</li>
<li><code>Innodb_row_lock_time_max</code>：最大等待时长，从系统启动到现在的最大等待时间。</li>
<li><code>Innodb_row_lock_waits</code>：从系统启动到现在，等待的次数。</li>
</ul>
</li>
</ol>
<h2 id="主从复制">主从复制</h2>
<h4 id="优点-1">优点</h4>
<ol>
<li>负载均衡</li>
<li>失败迁移</li>
</ol>
<h4 id="原理">原理</h4>
<ol>
<li>master将改变的数据记录在本地的二进制日志中（binary log）；该过程称为“二进制日志事件”。</li>
<li>slave将master的binary log拷贝到relay log（中继日志文件）中。</li>
<li>slave将数据从relay log读取到自己的数据库中，称为中继日志事件。</li>
</ol>
<h4 id="特点">特点</h4>
<ol>
<li>异步</li>
<li>串行话</li>
<li>有延迟</li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-06-17</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/mysql/">MySQL</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/linux-common-commands/" class="prev" rel="prev" title="【Linux】常见命令"><i class="fas fa-angle-left fa-fw"></i>【Linux】常见命令</a>
            <a href="/linux-du/" class="next" rel="next" title="【Linux】du命令详解">【Linux】du命令详解<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">damion</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{"gitalk":{"admin":[""],"clientID":"","clientSecret":"","id":"2020-06-17T14:21:40+08:00","owner":"","repo":"","title":"【MySQL】基本语法"}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
